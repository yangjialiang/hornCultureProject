webpackJsonp([19],{"i3+8":function(t,e){},oAQe:function(t,e){},oOw3:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n("//Fk"),a=n.n(r),i=n("Dd8w"),o=n.n(i),c=n("NYxO"),l=n("TrLn"),u=n("m8LM");var s=
/*!
 * Image Compressor v1.1.4
 * https://xkeshi.github.io/image-compressor
 *
 * Copyright 2017-present Chen Fengyuan
 * Released under the MIT license
 *
 * Date: 2018-06-20T07:28:41.051Z
 */
function(t,e){return t(e={exports:{}},e.exports),e.exports}(function(t){!function(e){var n=e.HTMLCanvasElement&&e.HTMLCanvasElement.prototype,r=e.Blob&&function(){try{return Boolean(new Blob)}catch(t){return!1}}(),a=r&&e.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(t){return!1}}(),i=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder,o=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,c=(r||i)&&e.atob&&e.ArrayBuffer&&e.Uint8Array&&function(t){var e,n,c,l,u,s,f,h,d;if(!(e=t.match(o)))throw new Error("invalid data URI");for(n=e[2]?e[1]:"text/plain"+(e[3]||";charset=US-ASCII"),c=!!e[4],l=t.slice(e[0].length),u=c?atob(l):decodeURIComponent(l),s=new ArrayBuffer(u.length),f=new Uint8Array(s),h=0;h<u.length;h+=1)f[h]=u.charCodeAt(h);return r?new Blob([a?f:s],{type:n}):((d=new i).append(s),d.getBlob(n))};e.HTMLCanvasElement&&!n.toBlob&&(n.mozGetAsFile?n.toBlob=function(t,e,r){var a=this;setTimeout(function(){r&&n.toDataURL&&c?t(c(a.toDataURL(e,r))):t(a.mozGetAsFile("blob",e))})}:n.toDataURL&&c&&(n.toBlob=function(t,e,n){var r=this;setTimeout(function(){t(c(r.toDataURL(e,n)))})})),t.exports?t.exports=c:e.dataURLtoBlob=c}(window)}),f=Object.prototype.toString,h={checkOrientation:!0,maxWidth:1/0,maxHeight:1/0,minWidth:0,minHeight:0,width:void 0,height:void 0,quality:.8,mimeType:"auto",convertSize:5e6,beforeDraw:null,drew:null,success:null,error:null},d=/^image\/.+$/;function m(t){return d.test(t)}var g=String.fromCharCode;var p=window.btoa;function v(t){var e=new DataView(t),n=void 0,r=void 0,a=void 0,i=void 0;if(255===e.getUint8(0)&&216===e.getUint8(1))for(var o=e.byteLength,c=2;c<o;){if(255===e.getUint8(c)&&225===e.getUint8(c+1)){a=c;break}c+=1}if(a){var l=a+10;if("Exif"===function(t,e,n){var r="",a=void 0;for(n+=e,a=e;a<n;a+=1)r+=g(t.getUint8(a));return r}(e,a+4,4)){var u=e.getUint16(l);if(((r=18761===u)||19789===u)&&42===e.getUint16(l+2,r)){var s=e.getUint32(l+4,r);s>=8&&(i=l+s)}}}if(i){var f=e.getUint16(i,r),h=void 0,d=void 0;for(d=0;d<f;d+=1)if(h=i+12*d+2,274===e.getUint16(h,r)){h+=8,n=e.getUint16(h,r),e.setUint16(h,1,r);break}}return n}var b=/\.\d*(?:0|9){12}\d*$/i;function w(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e11;return b.test(t)?Math.round(t*e)/e:t}var y=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},U=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),B=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},x=window,k=x.ArrayBuffer,M=x.FileReader,I=window.URL||window.webkitURL,T=/\.\w+$/,L=function(){function t(e,n){y(this,t),this.result=null,e&&this.compress(e,n)}return U(t,[{key:"compress",value:function(t,e){var n=this,r=new Image;return e=B({},h,e),k||(e.checkOrientation=!1),new Promise(function(n,r){if((a=t)instanceof Blob||"[object Blob]"===f.call(a)){var a,i=t.type;if(m(i))if(I||M){if(I&&!e.checkOrientation)n({url:I.createObjectURL(t)});else if(M){var o=new M,c=e.checkOrientation&&"image/jpeg"===i;o.onload=function(t){var e=t.target.result;n(c?B({url:function(t,e){var n=new Uint8Array(t),r="";if("function"==typeof n.forEach)n.forEach(function(t){r+=g(t)});else for(var a=n.length,i=0;i<a;i+=1)r+=g(n[i]);return"data:"+e+";base64,"+p(r)}(e,i)},function(t){var e=0,n=1,r=1;switch(t){case 2:n=-1;break;case 3:e=-180;break;case 4:r=-1;break;case 5:e=90,r=-1;break;case 6:e=90;break;case 7:e=90,n=-1;break;case 8:e=-90}return{rotate:e,scaleX:n,scaleY:r}}(v(e))):{url:e})},o.onabort=function(){r(new Error("Aborted to load the image with FileReader."))},o.onerror=function(){r(new Error("Failed to load the image with FileReader."))},c?o.readAsArrayBuffer(t):o.readAsDataURL(t)}}else r(new Error("The current browser does not support image compression."));else r(new Error("The first argument must be an image File or Blob object."))}else r(new Error("The first argument must be a File or Blob object."))}).then(function(e){return new Promise(function(n,a){r.onload=function(){return n(B({},e,{naturalWidth:r.naturalWidth,naturalHeight:r.naturalHeight}))},r.onabort=function(){a(new Error("Aborted to load the image."))},r.onerror=function(){a(new Error("Failed to load the image."))},r.alt=t.name,r.src=e.url})}).then(function(a){var i=a.naturalWidth,o=a.naturalHeight,c=a.rotate,l=void 0===c?0:c,u=a.scaleX,f=void 0===u?1:u,h=a.scaleY,d=void 0===h?1:h;return new Promise(function(a){var c=document.createElement("canvas"),u=c.getContext("2d"),h=i/o,g=Math.max(e.maxWidth,0)||1/0,p=Math.max(e.maxHeight,0)||1/0,v=Math.max(e.minWidth,0)||0,b=Math.max(e.minHeight,0)||0,y=i,U=o;if(g<1/0&&p<1/0?p*h>g?p=g/h:g=p*h:g<1/0?p=g/h:p<1/0&&(g=p*h),v>0&&b>0?b*h>v?b=v/h:v=b*h:v>0?b=v/h:b>0&&(v=b*h),e.width>0)U=(y=e.width)/h;else if(e.height>0){y=(U=e.height)*h}var B=-(y=Math.min(Math.max(y,v),g))/2,x=-(U=Math.min(Math.max(U,b),p))/2,k=y,M=U;if(Math.abs(l)%180==90){var I={width:U,height:y};y=I.width,U=I.height}c.width=w(y),c.height=w(U),m(e.mimeType)||(e.mimeType=t.type);var T="transparent";t.size>e.convertSize&&"image/png"===e.mimeType&&(T="#fff",e.mimeType="image/jpeg"),u.fillStyle=T,u.fillRect(0,0,y,U),u.save(),u.translate(y/2,U/2),u.rotate(l*Math.PI/180),u.scale(f,d),e.beforeDraw&&e.beforeDraw.call(n,u,c),u.drawImage(r,Math.floor(w(B)),Math.floor(w(x)),Math.floor(w(k)),Math.floor(w(M))),e.drew&&e.drew.call(n,u,c),u.restore();var L=function(t){a({naturalWidth:i,naturalHeight:o,result:t})};c.toBlob?c.toBlob(L,e.mimeType,e.quality):L(s(c.toDataURL(e.mimeType,e.quality)))})}).then(function(a){var i=a.naturalWidth,o=a.naturalHeight,c=a.result;if(I&&!e.checkOrientation&&I.revokeObjectURL(r.src),c)if(c.size>t.size&&e.mimeType===t.type&&!(e.width>i||e.height>o||e.minWidth>i||e.minHeight>o))c=t;else{var l=new Date;c.lastModified=l.getTime(),c.lastModifiedDate=l,c.name=t.name,c.name&&c.type!==t.type&&(c.name=c.name.replace(T,function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=m(t)?t.substr(6):"";return"jpeg"===n&&(n="jpg"),n&&e&&(n="."+n),n}(c.type)))}else c=t;return n.result=c,e.success&&e.success.call(n,c),Promise.resolve(c)}).catch(function(t){if(!e.error)throw t;e.error.call(n,t)})}}]),t}(),A={name:"",components:{FixedLayout:l.a,FileImage2:u.a},props:{},data:function(){return{myPreimg:[],myContent:""}},watch:{},computed:o()({},Object(c.c)({tagId:function(t){return t.write.post.tagId},clubId:function(t){return t.write.post.clubId},content:function(t){return t.write.post.myContent}})),created:function(){this.init()},mounted:function(){},methods:{init:function(){for(var t=0;t<3;t++)this.myPreimg.push({url:"",file:null})},initData:function(){},handNext:function(){var t=this;this.$store.commit(this.$actionType.set_post_data,{content:this.myContent,preimg:this.myPreimg});var e,n={clubId:this.clubId,tagId:this.tagId,cont:this.myContent,preimg:(e="",t.myPreimg.forEach(function(t){return t.url&&(e+=t.url+"#")}),e)};this.$http.post(this.$port.POST_DISCUSS,this.$qs.stringify(n)).then(function(e){200!==e.code?alert("发帖失败"):t.$router.push({path:"/forumPage"})})},uploadImg:function(t){var e=this;return alert("读取到图片信息"),new a.a(function(n,r){new L(t,{quality:.8,maxWidth:750,convertSize:2e6,success:function(t){var r=new FormData;r.append("imgType",1),r.append("upload",t,t.name),e.$http.post(e.$port.UPLOAD_IMG,r).then(function(t){n(t)})},error:function(t){console.log(t.message),r(t)}})})},handLoadImg:function(t,e,n){n.file=e,this.uploadImg(e).then(function(t){200===t.code?n.url=t.data:alert("图片上传失败")}).catch(function(){alert("图片压缩失败")})},handDeleteImage:function(t,e){t.file="",t.url=""}}},C={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("section",{staticStyle:{background:"#fff"}},[n("mt-header",{attrs:{title:"发帖"}},[n("router-link",{attrs:{slot:"left",to:"/"},slot:"left"},[n("mt-button",{attrs:{icon:"back"},on:{click:function(e){t.$router.go(-1)}}})],1),t._v(" "),n("mt-button",{attrs:{slot:"right"},on:{click:t.handNext},slot:"right"},[t._v("发送")])],1),t._v(" "),n("mt-field",{attrs:{placeholder:"请输入帖子内容",type:"textarea",rows:"4"},model:{value:t.myContent,callback:function(e){t.myContent=e},expression:"myContent"}}),t._v(" "),n("section",{staticClass:"m-uploads"},[t._l(t.myPreimg,function(e,r){return[n("file-image2",{attrs:{src:e.url},on:{load:function(n,r){return t.handLoadImg(n,r,e)},delete:function(n){t.handDeleteImage(e,r)}}})]})],2)],1)},staticRenderFns:[]};var D=n("VU/8")(A,C,!1,function(t){n("oAQe"),n("i3+8")},"data-v-0c309e5a",null);e.default=D.exports}});
//# sourceMappingURL=19.a92c18bdc3b55973e09d.js.map